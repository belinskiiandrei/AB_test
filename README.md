# Анализ результатов A/B-теста по оценке влияния новой функциональности

## Описание проекта

В проекте проведён анализ результатов A/B-теста, направленного на оценку влияния новой функциональности на пользовательские метрики.

Эксперимент включал проверку корректности системы сплитования, проведение A/A-теста и последующий анализ A/B-теста с использованием различных статистических методов.

## Постановка задачи

Цель анализа — определить, приводит ли внедрение новой функциональности к статистически значимому изменению целевой метрики по сравнению с контрольной версией продукта.

## Формализация гипотез

H0: статистически значимые различия между группами отсутствуют.
H1: между группами существует статистически значимое различие.

## Описание данных

В анализируемом наборе данных представлены следующие поля:

- `user_id` — уникальный идентификатор пользователя

- `exp_group` — номер экспериментальной группы

- `tim`e — время действия

- `action` — вид взаимодействия

Перед проведением анализа выполнены:

- проверка корректности распределения пользователей по группам;

- поиск и удаление дубликатов;

- проверка пропусков и аномальных значений.

## Логика распределения пользователей по группам

Пользователи распределяются по группам детерминированным способом на основе хеш-функции от `user_id`. Такой подход обеспечивает:

- воспроизводимость эксперимента;

- равномерное распределение;

- отсутствие повторного назначения группы одному и тому же пользователю.

## A/A-тест

Перед анализом A/B-теста проведён A/A-тест для проверки корректности работы системы сплитования.

Необходимо убедиться, что группы:

- имеют сопоставимое количество пользователей;

- не отличаются по исследуемым метрикам до внедрения изменений.

A/A-тест проходил с 8 по 14 ноября 2021 года.
A/B-тест проводился с 15 по 21 ноября 2021 года.

Корректность A/A-теста является критически важным условием для дальнейшей интерпретации результатов A/B-теста.

## Описание эксперимента

С 15.11 по 21.11 проводились два параллельных теста.

**Первый тест**

- `exp_group` = 1 — контроль (без изменений)

- `exp_group` = 2 — рекомендации «похожих на лайкнутые посты»

**Второй тест**

- `exp_group` = 0 — контроль (без изменений)

- `exp_group` = 3 — рекомендации «постов, которые лайкали похожие на вас люди»

## Используемые статистические методы

В ходе анализа применялись следующие методы:

- независимый двухвыборочный t-тест;

- тест Манна–Уитни;

- непараметрический bootstrap;

- пуассоновский bootstrap;

- бакетное преобразование;

- сглаженный CTR;

- линеаризация метрики.

Уровень значимости — 0.05.

Проблема множественного сравнения отдельно не учитывалась, поскольку итоговые выводы делались на основе t-теста.

## Сглаженный CTR

Проблема использования пользовательского CTR заключается в высокой дисперсии у пользователей с малым количеством просмотров.

Применялось сглаживание Лапласа:

- при большом количестве просмотров сглаженный CTR приближается к пользовательскому;

- при малом количестве просмотров сглаженный CTR приближается к общегрупповому значению.

Отмечается, что направление эффекта сглаженного CTR не гарантированно совпадает с направлением эффекта по общему числу кликов.

## Бакетное преобразование

Пользователи разбиваются на несколько корзин (бакетов) с использованием хеширования с солью.

Каждый бакет рассматривается как «метапользователь», внутри которого агрегируется метрика (например, среднее значение).

Далее сравнение между группами проводится на уровне бакетов с применением статистических тестов.

## Линеаризация

Алгоритм линеаризации:

1. Рассчитывается общий CTR в контрольной группе:
CTR_control = sum(likes) / sum(views)

2. Рассчитывается поюзерная метрика:
linearized_likes = likes − CTR_control × views

3. Выполняется t-тест по метрике linearized_likes.

## Выводы

По результатам одного из тестов получено статистически значимое различие между группами (p-value < 0.05), что указывает на наличие эффекта.

Однако дополнительный анализ показал неоднозначность результатов:

- t-тест не всегда фиксировал различия;

- тест Манна–Уитни выявлял разницу;

- bootstrap и бакетный подход давали отличающиеся оценки.

Проведённый A/A-тест подтвердил, что до внедрения изменений группы вели себя одинаково.

Предполагается, что новая система рекомендаций влияет на пользователей неоднородно:

- часть пользователей получает положительный эффект;

- у части пользователей наблюдается снижение ключевой метрики.

Рекомендации

1. Доработать систему сплитования при тестировании функциональности, зависящей от взаимосвязей между пользователями.

2. Не выкатывать изменения на всех пользователей, поскольку наблюдаемый эффект негативно сказывается на ключевой метрике для значительной части аудитории.
